<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>My Community Map</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">
    <link rel="shortcut icon" href="/favicon.ico">
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <!-- build:css(.) styles/vendor.css -->
    <!-- bower:css -->
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.css" />
    <!-- endbower -->
    <!-- endbuild -->
    <!-- build:css(.tmp) styles/main.css -->
    <link rel="stylesheet" href="styles/main.css">
    <!-- endbuild -->
    
    <style type="text/css">
      html, body, #map-canvas { height: 100%; margin: 0; padding: 0;}
    </style>
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC_r0PCbmCb9jhB-6Nr8WBhae6QelSUYCE">
    </script>
    <script type="text/javascript">
      function initialize() {
//        navigator.geolocation.getCurrentPosition(loadGoogleMap);
        var positionPENS = {
          coords: {
            latitude: -7.2764785,
            longitude: 112.7941515
          }
        };
        loadGoogleMap(positionPENS);
      }
      
      function loadGoogleMap(position){
        console.log(position);
        var mapOptions = {
          center: { lat: position.coords.latitude, lng: position.coords.longitude },
          zoom: 20,
          scaleControl: true
        };
        var map = new google.maps.Map(document.getElementById('map-canvas'),
            mapOptions);
        
        var infowindow = new google.maps.InfoWindow();
        
        $.getJSON('data.json', function(data){
          console.log(data);
          for(var i = 0; i < data.length; i++){
            var marker = new google.maps.Marker({
                position: new google.maps.LatLng(data[i].latitude, data[i].longitude),
                map: map,
                title: data[i].title
              });
            
            var contentString = 
                '<div style="line-height:1.35;overflow:hidden;white-space:nowrap;">' +
                '<h1>' + data[i].title + '</h1>' +
                '<p>' +
                '<img src="' + data[i].photo + '">' + '<br>' +
                '<a href="#" target="_blank">Details</a>' +
                '</p>' + 
                '</div>';
            
            google.maps.event.addListener(
              marker, 
              'click', 
              (function(marker, content){
                return function(){
                  infowindow.close();
                  infowindow.setContent(content);
                  infowindow.open(map, marker);
                };
              })(marker, contentString));
          }
        });
        
//        google.maps.event.addListener(marker, 'click', function() {
//          infowindow.open(map,marker);
//        });
      }
        
      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  </head>
  <body>
    <div id="map-canvas"></div>
    
    <!-- build:js(.) scripts/vendor.js -->
    <!-- bower:js -->
    <script src="bower_components/jquery/dist/jquery.js"></script>
    <!-- endbower -->
    <!-- endbuild -->
  </body>
</html>